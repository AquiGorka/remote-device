<!DOCTYPE html>
<html>
	<head>
		<title>Remote Device Puppet</title>
	</head>
	<body>
		<!-- libs -->
		<script src="libs/socket.io/socket.io.js"></script>
		
		<!-- app -->
		<script>
			(function () {
				"use strict";

				var socket,
					data = {
						orientation: {
							alpha: 0,
							beta: 0,
							gamma: 0
						},
						motion: {
							x: 0,
							y: 0,
							z: 0
						}
					};

				var init = function () {
					socket = io('http://' + window.location.host);
					socket.on('connect', function () {
						// am I accepted as puppet?
						socket.on('puppet-connect', function () {
							//
							setupHandlers();
						})
						//
						socket.emit('puppet-connect');
					});	
				};

				var sendData = function () {
					socket.emit('data', data);
				};

				var setupHandlers = function () {
					// handlers
					window.ondevicemotion = function (event) {
						data.motion = {
							x: event.acceleration.x,
							y: event.acceleration.y,
							z: event.acceleration.z
						}
						//
						sendData();
					}
					window.ondeviceorientation = function (event) {
						data.orientation = {
							alpha: event.alpha,
							beta: event.beta,
							gamma: event.gamma
						};
						//
						sendData();
					}
				};
				
				init();

			})();
		</script>
	</body>
</html>